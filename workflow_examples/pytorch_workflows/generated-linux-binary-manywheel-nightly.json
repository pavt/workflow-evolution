{
  "name": "linux-binary-manywheel",
  "on": {
    "push": {
      "branches": [
        "nightly"
      ],
      "tags": [
        "v[0-9]+.[0-9]+.[0-9]+-rc[0-9]+",
        "ciflow/binaries/*",
        "ciflow/binaries_wheel/*"
      ]
    },
    "workflow_dispatch": null
  },
  "env": {
    "ALPINE_IMAGE": "308535385114.dkr.ecr.us-east-1.amazonaws.com/tool/alpine",
    "ANACONDA_USER": "pytorch",
    "AWS_DEFAULT_REGION": "us-east-1",
    "BINARY_ENV_FILE": "/tmp/env",
    "BUILD_ENVIRONMENT": "linux-binary-manywheel",
    "BUILDER_ROOT": "/builder",
    "GITHUB_TOKEN": "${{ secrets.GITHUB_TOKEN }}",
    "PR_NUMBER": "${{ github.event.pull_request.number }}",
    "PYTORCH_FINAL_PACKAGE_DIR": "/artifacts",
    "PYTORCH_ROOT": "/pytorch",
    "SHA1": "${{ github.event.pull_request.head.sha || github.sha }}",
    "SKIP_ALL_TESTS": 1
  },
  "concurrency": {
    "group": "linux-binary-manywheel-${{ github.event.pull_request.number || github.ref_name }}-${{ github.ref_type == 'branch' && github.sha }}-${{ github.event_name == 'workflow_dispatch' }}",
    "cancel-in-progress": true
  },
  "jobs": {
    "manywheel-py3_7-cpu-build": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "uses": "./.github/workflows/_binary-build-linux.yml",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cpu",
        "GPU_ARCH_TYPE": "cpu",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cpu",
        "DESIRED_PYTHON": "3.7",
        "build_name": "manywheel-py3_7-cpu",
        "build_environment": "linux-binary-manywheel"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}"
      }
    },
    "manywheel-py3_7-cpu-test": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_7-cpu-build",
      "uses": "./.github/workflows/_binary-test-linux.yml",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cpu",
        "GPU_ARCH_TYPE": "cpu",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cpu",
        "DESIRED_PYTHON": "3.7",
        "build_name": "manywheel-py3_7-cpu",
        "build_environment": "linux-binary-manywheel",
        "runs_on": "linux.4xlarge"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}"
      }
    },
    "manywheel-py3_7-cpu-upload": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_7-cpu-test",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cpu",
        "GPU_ARCH_TYPE": "cpu",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cpu",
        "DESIRED_PYTHON": "3.7",
        "build_name": "manywheel-py3_7-cpu"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}",
        "aws-access-key-id": "${{ secrets.AWS_PYTORCH_UPLOADER_ACCESS_KEY_ID }}",
        "aws-pytorch-uploader-secret-access-key": "${{ secrets.AWS_PYTORCH_UPLOADER_SECRET_ACCESS_KEY }}",
        "conda-pytorchbot-token": "${{ secrets.CONDA_PYTORCHBOT_TOKEN }}"
      },
      "uses": "./.github/workflows/_binary-upload.yml"
    },
    "manywheel-py3_7-cuda11_6-build": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "uses": "./.github/workflows/_binary-build-linux.yml",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cu116",
        "GPU_ARCH_VERSION": 11.6,
        "GPU_ARCH_TYPE": "cuda",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cuda11.6",
        "DESIRED_PYTHON": "3.7",
        "build_name": "manywheel-py3_7-cuda11_6",
        "build_environment": "linux-binary-manywheel"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}"
      }
    },
    "manywheel-py3_7-cuda11_6-test": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_7-cuda11_6-build",
      "uses": "./.github/workflows/_binary-test-linux.yml",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cu116",
        "GPU_ARCH_VERSION": 11.6,
        "GPU_ARCH_TYPE": "cuda",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cuda11.6",
        "DESIRED_PYTHON": "3.7",
        "build_name": "manywheel-py3_7-cuda11_6",
        "build_environment": "linux-binary-manywheel",
        "runs_on": "linux.4xlarge.nvidia.gpu"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}"
      }
    },
    "manywheel-py3_7-cuda11_6-upload": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_7-cuda11_6-test",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cu116",
        "GPU_ARCH_VERSION": 11.6,
        "GPU_ARCH_TYPE": "cuda",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cuda11.6",
        "DESIRED_PYTHON": "3.7",
        "build_name": "manywheel-py3_7-cuda11_6"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}",
        "aws-access-key-id": "${{ secrets.AWS_PYTORCH_UPLOADER_ACCESS_KEY_ID }}",
        "aws-pytorch-uploader-secret-access-key": "${{ secrets.AWS_PYTORCH_UPLOADER_SECRET_ACCESS_KEY }}",
        "conda-pytorchbot-token": "${{ secrets.CONDA_PYTORCHBOT_TOKEN }}"
      },
      "uses": "./.github/workflows/_binary-upload.yml"
    },
    "manywheel-py3_7-cuda11_7-with-pypi-cudnn-build": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "uses": "./.github/workflows/_binary-build-linux.yml",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cu117",
        "GPU_ARCH_VERSION": 11.7,
        "GPU_ARCH_TYPE": "cuda",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cuda11.7",
        "DESIRED_PYTHON": "3.7",
        "build_name": "manywheel-py3_7-cuda11_7-with-pypi-cudnn",
        "build_environment": "linux-binary-manywheel",
        "PYTORCH_EXTRA_INSTALL_REQUIREMENTS": "nvidia-cuda-runtime-cu11;nvidia-cudnn-cu11==8.5.0.96;nvidia-cublas-cu11==11.10.3.66"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}"
      }
    },
    "manywheel-py3_7-cuda11_7-with-pypi-cudnn-test": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_7-cuda11_7-with-pypi-cudnn-build",
      "uses": "./.github/workflows/_binary-test-linux.yml",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cu117",
        "GPU_ARCH_VERSION": 11.7,
        "GPU_ARCH_TYPE": "cuda",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cuda11.7",
        "DESIRED_PYTHON": "3.7",
        "build_name": "manywheel-py3_7-cuda11_7-with-pypi-cudnn",
        "build_environment": "linux-binary-manywheel",
        "runs_on": "linux.4xlarge.nvidia.gpu"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}"
      }
    },
    "manywheel-py3_7-cuda11_7-with-pypi-cudnn-upload": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_7-cuda11_7-with-pypi-cudnn-test",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cu117",
        "GPU_ARCH_VERSION": 11.7,
        "GPU_ARCH_TYPE": "cuda",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cuda11.7",
        "DESIRED_PYTHON": "3.7",
        "build_name": "manywheel-py3_7-cuda11_7-with-pypi-cudnn"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}",
        "aws-access-key-id": "${{ secrets.AWS_PYTORCH_UPLOADER_ACCESS_KEY_ID }}",
        "aws-pytorch-uploader-secret-access-key": "${{ secrets.AWS_PYTORCH_UPLOADER_SECRET_ACCESS_KEY }}",
        "conda-pytorchbot-token": "${{ secrets.CONDA_PYTORCHBOT_TOKEN }}"
      },
      "uses": "./.github/workflows/_binary-upload.yml"
    },
    "manywheel-py3_7-cuda11_7-build": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "uses": "./.github/workflows/_binary-build-linux.yml",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cu117",
        "GPU_ARCH_VERSION": 11.7,
        "GPU_ARCH_TYPE": "cuda",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cuda11.7",
        "DESIRED_PYTHON": "3.7",
        "build_name": "manywheel-py3_7-cuda11_7",
        "build_environment": "linux-binary-manywheel"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}"
      }
    },
    "manywheel-py3_7-cuda11_7-test": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_7-cuda11_7-build",
      "uses": "./.github/workflows/_binary-test-linux.yml",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cu117",
        "GPU_ARCH_VERSION": 11.7,
        "GPU_ARCH_TYPE": "cuda",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cuda11.7",
        "DESIRED_PYTHON": "3.7",
        "build_name": "manywheel-py3_7-cuda11_7",
        "build_environment": "linux-binary-manywheel",
        "runs_on": "linux.4xlarge.nvidia.gpu"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}"
      }
    },
    "manywheel-py3_7-cuda11_7-upload": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_7-cuda11_7-test",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cu117",
        "GPU_ARCH_VERSION": 11.7,
        "GPU_ARCH_TYPE": "cuda",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cuda11.7",
        "DESIRED_PYTHON": "3.7",
        "build_name": "manywheel-py3_7-cuda11_7"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}",
        "aws-access-key-id": "${{ secrets.AWS_PYTORCH_UPLOADER_ACCESS_KEY_ID }}",
        "aws-pytorch-uploader-secret-access-key": "${{ secrets.AWS_PYTORCH_UPLOADER_SECRET_ACCESS_KEY }}",
        "conda-pytorchbot-token": "${{ secrets.CONDA_PYTORCHBOT_TOKEN }}"
      },
      "uses": "./.github/workflows/_binary-upload.yml"
    },
    "manywheel-py3_7-rocm5_1_1-build": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "uses": "./.github/workflows/_binary-build-linux.yml",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "rocm5.1.1",
        "GPU_ARCH_VERSION": "5.1.1",
        "GPU_ARCH_TYPE": "rocm",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:rocm5.1.1",
        "DESIRED_PYTHON": "3.7",
        "build_name": "manywheel-py3_7-rocm5_1_1",
        "build_environment": "linux-binary-manywheel"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}"
      }
    },
    "manywheel-py3_7-rocm5_1_1-test": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_7-rocm5_1_1-build",
      "runs-on": "linux.rocm.gpu",
      "timeout-minutes": 240,
      "env": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "rocm5.1.1",
        "GPU_ARCH_VERSION": "5.1.1",
        "GPU_ARCH_TYPE": "rocm",
        "SKIP_ALL_TESTS": 1,
        "DOCKER_IMAGE": "pytorch/manylinux-builder:rocm5.1.1",
        "DESIRED_PYTHON": "3.7"
      },
      "steps": [
        {
          "name": "Clean workspace",
          "run": "rm -rf \"${GITHUB_WORKSPACE}\"\nmkdir \"${GITHUB_WORKSPACE}\"\n"
        },
        {
          "name": "Set DOCKER_HOST",
          "run": "echo \"DOCKER_HOST=unix:///run/user/$(id -u)/docker.sock\" >> \"${GITHUB_ENV}\""
        },
        {
          "name": "Runner health check system info",
          "if": "always()",
          "run": "cat /etc/os-release || true\ncat /etc/apt/sources.list.d/rocm.list || true\ncat /opt/rocm/.info/version || true\nwhoami\n"
        },
        {
          "name": "Runner health check rocm-smi",
          "if": "always()",
          "run": "rocm-smi\n"
        },
        {
          "name": "Runner health check rocminfo",
          "if": "always()",
          "run": "rocminfo\n"
        },
        {
          "name": "Runner health check GPU count",
          "if": "always()",
          "run": "ngpu=$(rocminfo | grep -c -E 'Name:.*\\sgfx')\nif [[ \"x$ngpu\" != \"x2\" && \"x$ngpu\" != \"x4\" ]]; then\n    echo \"Failed to detect GPUs on the runner\"\n    exit 1\nfi\n"
        },
        {
          "name": "Runner health check disconnect on failure",
          "if": "${{ failure() }}",
          "run": "killall runsvc.sh\n"
        },
        {
          "name": "Preserve github env variables for use in docker",
          "run": "env | grep '^GITHUB' >> \"/tmp/github_env_${GITHUB_RUN_ID}\"\nenv | grep '^CI' >> \"/tmp/github_env_${GITHUB_RUN_ID}\"\n"
        },
        {
          "uses": "actions/download-artifact@v3",
          "name": "Download Build Artifacts",
          "with": {
            "name": "manywheel-py3_7-rocm5_1_1",
            "path": "${{ runner.temp }}/artifacts/"
          }
        },
        {
          "name": "Checkout PyTorch",
          "uses": "zhouzhuojie/checkout@05b13c9a0d21f08f6d5e64a1d5042246d13619d9",
          "with": {
            "ref": "${{ github.event_name == 'pull_request' && github.event.pull_request.head.sha || github.sha }}",
            "submodules": "recursive",
            "path": "pytorch"
          }
        },
        {
          "name": "Clean PyTorch checkout",
          "run": "# Remove any artifacts from the previous checkouts\ngit clean -fxd\n",
          "working-directory": "pytorch"
        },
        {
          "name": "Checkout pytorch/builder",
          "uses": "zhouzhuojie/checkout@05b13c9a0d21f08f6d5e64a1d5042246d13619d9",
          "with": {
            "ref": "main",
            "submodules": "recursive",
            "repository": "pytorch/builder",
            "path": "builder"
          }
        },
        {
          "name": "Clean pytorch/builder checkout",
          "run": "# Remove any artifacts from the previous checkouts\ngit clean -fxd\n",
          "working-directory": "builder"
        },
        {
          "name": "ROCm set GPU_FLAG",
          "run": "echo \"GPU_FLAG=--device=/dev/mem --device=/dev/kfd --device=/dev/dri --group-add video --group-add daemon\" >> \"${GITHUB_ENV}\"\n"
        },
        {
          "name": "Pull Docker image",
          "uses": "pytorch/test-infra/.github/actions/pull-docker-image@main",
          "with": {
            "docker-image": "pytorch/manylinux-builder:rocm5.1.1"
          }
        },
        {
          "name": "Test Pytorch binary",
          "uses": "./pytorch/.github/actions/test-pytorch-binary"
        },
        {
          "name": "Kill containers, clean up images",
          "if": "always()",
          "run": "# ignore expansion of \"docker ps -q\" since it could be empty\n# shellcheck disable=SC2046\ndocker stop $(docker ps -q) || true\n# Prune all of the docker images\ndocker system prune -af\n"
        }
      ]
    },
    "manywheel-py3_7-rocm5_1_1-upload": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_7-rocm5_1_1-test",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "rocm5.1.1",
        "GPU_ARCH_VERSION": "5.1.1",
        "GPU_ARCH_TYPE": "rocm",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:rocm5.1.1",
        "DESIRED_PYTHON": "3.7",
        "build_name": "manywheel-py3_7-rocm5_1_1"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}",
        "aws-access-key-id": "${{ secrets.AWS_PYTORCH_UPLOADER_ACCESS_KEY_ID }}",
        "aws-pytorch-uploader-secret-access-key": "${{ secrets.AWS_PYTORCH_UPLOADER_SECRET_ACCESS_KEY }}",
        "conda-pytorchbot-token": "${{ secrets.CONDA_PYTORCHBOT_TOKEN }}"
      },
      "uses": "./.github/workflows/_binary-upload.yml"
    },
    "manywheel-py3_7-rocm5_2-build": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "uses": "./.github/workflows/_binary-build-linux.yml",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "rocm5.2",
        "GPU_ARCH_VERSION": 5.2,
        "GPU_ARCH_TYPE": "rocm",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:rocm5.2",
        "DESIRED_PYTHON": "3.7",
        "build_name": "manywheel-py3_7-rocm5_2",
        "build_environment": "linux-binary-manywheel"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}"
      }
    },
    "manywheel-py3_7-rocm5_2-test": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_7-rocm5_2-build",
      "runs-on": "linux.rocm.gpu",
      "timeout-minutes": 240,
      "env": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "rocm5.2",
        "GPU_ARCH_VERSION": 5.2,
        "GPU_ARCH_TYPE": "rocm",
        "SKIP_ALL_TESTS": 1,
        "DOCKER_IMAGE": "pytorch/manylinux-builder:rocm5.2",
        "DESIRED_PYTHON": "3.7"
      },
      "steps": [
        {
          "name": "Clean workspace",
          "run": "rm -rf \"${GITHUB_WORKSPACE}\"\nmkdir \"${GITHUB_WORKSPACE}\"\n"
        },
        {
          "name": "Set DOCKER_HOST",
          "run": "echo \"DOCKER_HOST=unix:///run/user/$(id -u)/docker.sock\" >> \"${GITHUB_ENV}\""
        },
        {
          "name": "Runner health check system info",
          "if": "always()",
          "run": "cat /etc/os-release || true\ncat /etc/apt/sources.list.d/rocm.list || true\ncat /opt/rocm/.info/version || true\nwhoami\n"
        },
        {
          "name": "Runner health check rocm-smi",
          "if": "always()",
          "run": "rocm-smi\n"
        },
        {
          "name": "Runner health check rocminfo",
          "if": "always()",
          "run": "rocminfo\n"
        },
        {
          "name": "Runner health check GPU count",
          "if": "always()",
          "run": "ngpu=$(rocminfo | grep -c -E 'Name:.*\\sgfx')\nif [[ \"x$ngpu\" != \"x2\" && \"x$ngpu\" != \"x4\" ]]; then\n    echo \"Failed to detect GPUs on the runner\"\n    exit 1\nfi\n"
        },
        {
          "name": "Runner health check disconnect on failure",
          "if": "${{ failure() }}",
          "run": "killall runsvc.sh\n"
        },
        {
          "name": "Preserve github env variables for use in docker",
          "run": "env | grep '^GITHUB' >> \"/tmp/github_env_${GITHUB_RUN_ID}\"\nenv | grep '^CI' >> \"/tmp/github_env_${GITHUB_RUN_ID}\"\n"
        },
        {
          "uses": "actions/download-artifact@v3",
          "name": "Download Build Artifacts",
          "with": {
            "name": "manywheel-py3_7-rocm5_2",
            "path": "${{ runner.temp }}/artifacts/"
          }
        },
        {
          "name": "Checkout PyTorch",
          "uses": "zhouzhuojie/checkout@05b13c9a0d21f08f6d5e64a1d5042246d13619d9",
          "with": {
            "ref": "${{ github.event_name == 'pull_request' && github.event.pull_request.head.sha || github.sha }}",
            "submodules": "recursive",
            "path": "pytorch"
          }
        },
        {
          "name": "Clean PyTorch checkout",
          "run": "# Remove any artifacts from the previous checkouts\ngit clean -fxd\n",
          "working-directory": "pytorch"
        },
        {
          "name": "Checkout pytorch/builder",
          "uses": "zhouzhuojie/checkout@05b13c9a0d21f08f6d5e64a1d5042246d13619d9",
          "with": {
            "ref": "main",
            "submodules": "recursive",
            "repository": "pytorch/builder",
            "path": "builder"
          }
        },
        {
          "name": "Clean pytorch/builder checkout",
          "run": "# Remove any artifacts from the previous checkouts\ngit clean -fxd\n",
          "working-directory": "builder"
        },
        {
          "name": "ROCm set GPU_FLAG",
          "run": "echo \"GPU_FLAG=--device=/dev/mem --device=/dev/kfd --device=/dev/dri --group-add video --group-add daemon\" >> \"${GITHUB_ENV}\"\n"
        },
        {
          "name": "Pull Docker image",
          "uses": "pytorch/test-infra/.github/actions/pull-docker-image@main",
          "with": {
            "docker-image": "pytorch/manylinux-builder:rocm5.2"
          }
        },
        {
          "name": "Test Pytorch binary",
          "uses": "./pytorch/.github/actions/test-pytorch-binary"
        },
        {
          "name": "Kill containers, clean up images",
          "if": "always()",
          "run": "# ignore expansion of \"docker ps -q\" since it could be empty\n# shellcheck disable=SC2046\ndocker stop $(docker ps -q) || true\n# Prune all of the docker images\ndocker system prune -af\n"
        }
      ]
    },
    "manywheel-py3_7-rocm5_2-upload": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_7-rocm5_2-test",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "rocm5.2",
        "GPU_ARCH_VERSION": 5.2,
        "GPU_ARCH_TYPE": "rocm",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:rocm5.2",
        "DESIRED_PYTHON": "3.7",
        "build_name": "manywheel-py3_7-rocm5_2"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}",
        "aws-access-key-id": "${{ secrets.AWS_PYTORCH_UPLOADER_ACCESS_KEY_ID }}",
        "aws-pytorch-uploader-secret-access-key": "${{ secrets.AWS_PYTORCH_UPLOADER_SECRET_ACCESS_KEY }}",
        "conda-pytorchbot-token": "${{ secrets.CONDA_PYTORCHBOT_TOKEN }}"
      },
      "uses": "./.github/workflows/_binary-upload.yml"
    },
    "manywheel-py3_8-cpu-build": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "uses": "./.github/workflows/_binary-build-linux.yml",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cpu",
        "GPU_ARCH_TYPE": "cpu",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cpu",
        "DESIRED_PYTHON": "3.8",
        "build_name": "manywheel-py3_8-cpu",
        "build_environment": "linux-binary-manywheel"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}"
      }
    },
    "manywheel-py3_8-cpu-test": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_8-cpu-build",
      "uses": "./.github/workflows/_binary-test-linux.yml",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cpu",
        "GPU_ARCH_TYPE": "cpu",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cpu",
        "DESIRED_PYTHON": "3.8",
        "build_name": "manywheel-py3_8-cpu",
        "build_environment": "linux-binary-manywheel",
        "runs_on": "linux.4xlarge"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}"
      }
    },
    "manywheel-py3_8-cpu-upload": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_8-cpu-test",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cpu",
        "GPU_ARCH_TYPE": "cpu",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cpu",
        "DESIRED_PYTHON": "3.8",
        "build_name": "manywheel-py3_8-cpu"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}",
        "aws-access-key-id": "${{ secrets.AWS_PYTORCH_UPLOADER_ACCESS_KEY_ID }}",
        "aws-pytorch-uploader-secret-access-key": "${{ secrets.AWS_PYTORCH_UPLOADER_SECRET_ACCESS_KEY }}",
        "conda-pytorchbot-token": "${{ secrets.CONDA_PYTORCHBOT_TOKEN }}"
      },
      "uses": "./.github/workflows/_binary-upload.yml"
    },
    "manywheel-py3_8-cuda11_6-build": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "uses": "./.github/workflows/_binary-build-linux.yml",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cu116",
        "GPU_ARCH_VERSION": 11.6,
        "GPU_ARCH_TYPE": "cuda",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cuda11.6",
        "DESIRED_PYTHON": "3.8",
        "build_name": "manywheel-py3_8-cuda11_6",
        "build_environment": "linux-binary-manywheel"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}"
      }
    },
    "manywheel-py3_8-cuda11_6-test": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_8-cuda11_6-build",
      "uses": "./.github/workflows/_binary-test-linux.yml",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cu116",
        "GPU_ARCH_VERSION": 11.6,
        "GPU_ARCH_TYPE": "cuda",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cuda11.6",
        "DESIRED_PYTHON": "3.8",
        "build_name": "manywheel-py3_8-cuda11_6",
        "build_environment": "linux-binary-manywheel",
        "runs_on": "linux.4xlarge.nvidia.gpu"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}"
      }
    },
    "manywheel-py3_8-cuda11_6-upload": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_8-cuda11_6-test",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cu116",
        "GPU_ARCH_VERSION": 11.6,
        "GPU_ARCH_TYPE": "cuda",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cuda11.6",
        "DESIRED_PYTHON": "3.8",
        "build_name": "manywheel-py3_8-cuda11_6"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}",
        "aws-access-key-id": "${{ secrets.AWS_PYTORCH_UPLOADER_ACCESS_KEY_ID }}",
        "aws-pytorch-uploader-secret-access-key": "${{ secrets.AWS_PYTORCH_UPLOADER_SECRET_ACCESS_KEY }}",
        "conda-pytorchbot-token": "${{ secrets.CONDA_PYTORCHBOT_TOKEN }}"
      },
      "uses": "./.github/workflows/_binary-upload.yml"
    },
    "manywheel-py3_8-cuda11_7-with-pypi-cudnn-build": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "uses": "./.github/workflows/_binary-build-linux.yml",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cu117",
        "GPU_ARCH_VERSION": 11.7,
        "GPU_ARCH_TYPE": "cuda",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cuda11.7",
        "DESIRED_PYTHON": "3.8",
        "build_name": "manywheel-py3_8-cuda11_7-with-pypi-cudnn",
        "build_environment": "linux-binary-manywheel",
        "PYTORCH_EXTRA_INSTALL_REQUIREMENTS": "nvidia-cuda-runtime-cu11;nvidia-cudnn-cu11==8.5.0.96;nvidia-cublas-cu11==11.10.3.66"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}"
      }
    },
    "manywheel-py3_8-cuda11_7-with-pypi-cudnn-test": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_8-cuda11_7-with-pypi-cudnn-build",
      "uses": "./.github/workflows/_binary-test-linux.yml",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cu117",
        "GPU_ARCH_VERSION": 11.7,
        "GPU_ARCH_TYPE": "cuda",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cuda11.7",
        "DESIRED_PYTHON": "3.8",
        "build_name": "manywheel-py3_8-cuda11_7-with-pypi-cudnn",
        "build_environment": "linux-binary-manywheel",
        "runs_on": "linux.4xlarge.nvidia.gpu"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}"
      }
    },
    "manywheel-py3_8-cuda11_7-with-pypi-cudnn-upload": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_8-cuda11_7-with-pypi-cudnn-test",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cu117",
        "GPU_ARCH_VERSION": 11.7,
        "GPU_ARCH_TYPE": "cuda",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cuda11.7",
        "DESIRED_PYTHON": "3.8",
        "build_name": "manywheel-py3_8-cuda11_7-with-pypi-cudnn"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}",
        "aws-access-key-id": "${{ secrets.AWS_PYTORCH_UPLOADER_ACCESS_KEY_ID }}",
        "aws-pytorch-uploader-secret-access-key": "${{ secrets.AWS_PYTORCH_UPLOADER_SECRET_ACCESS_KEY }}",
        "conda-pytorchbot-token": "${{ secrets.CONDA_PYTORCHBOT_TOKEN }}"
      },
      "uses": "./.github/workflows/_binary-upload.yml"
    },
    "manywheel-py3_8-cuda11_7-build": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "uses": "./.github/workflows/_binary-build-linux.yml",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cu117",
        "GPU_ARCH_VERSION": 11.7,
        "GPU_ARCH_TYPE": "cuda",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cuda11.7",
        "DESIRED_PYTHON": "3.8",
        "build_name": "manywheel-py3_8-cuda11_7",
        "build_environment": "linux-binary-manywheel"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}"
      }
    },
    "manywheel-py3_8-cuda11_7-test": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_8-cuda11_7-build",
      "uses": "./.github/workflows/_binary-test-linux.yml",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cu117",
        "GPU_ARCH_VERSION": 11.7,
        "GPU_ARCH_TYPE": "cuda",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cuda11.7",
        "DESIRED_PYTHON": "3.8",
        "build_name": "manywheel-py3_8-cuda11_7",
        "build_environment": "linux-binary-manywheel",
        "runs_on": "linux.4xlarge.nvidia.gpu"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}"
      }
    },
    "manywheel-py3_8-cuda11_7-upload": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_8-cuda11_7-test",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cu117",
        "GPU_ARCH_VERSION": 11.7,
        "GPU_ARCH_TYPE": "cuda",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cuda11.7",
        "DESIRED_PYTHON": "3.8",
        "build_name": "manywheel-py3_8-cuda11_7"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}",
        "aws-access-key-id": "${{ secrets.AWS_PYTORCH_UPLOADER_ACCESS_KEY_ID }}",
        "aws-pytorch-uploader-secret-access-key": "${{ secrets.AWS_PYTORCH_UPLOADER_SECRET_ACCESS_KEY }}",
        "conda-pytorchbot-token": "${{ secrets.CONDA_PYTORCHBOT_TOKEN }}"
      },
      "uses": "./.github/workflows/_binary-upload.yml"
    },
    "manywheel-py3_8-rocm5_1_1-build": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "uses": "./.github/workflows/_binary-build-linux.yml",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "rocm5.1.1",
        "GPU_ARCH_VERSION": "5.1.1",
        "GPU_ARCH_TYPE": "rocm",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:rocm5.1.1",
        "DESIRED_PYTHON": "3.8",
        "build_name": "manywheel-py3_8-rocm5_1_1",
        "build_environment": "linux-binary-manywheel"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}"
      }
    },
    "manywheel-py3_8-rocm5_1_1-test": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_8-rocm5_1_1-build",
      "runs-on": "linux.rocm.gpu",
      "timeout-minutes": 240,
      "env": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "rocm5.1.1",
        "GPU_ARCH_VERSION": "5.1.1",
        "GPU_ARCH_TYPE": "rocm",
        "SKIP_ALL_TESTS": 1,
        "DOCKER_IMAGE": "pytorch/manylinux-builder:rocm5.1.1",
        "DESIRED_PYTHON": "3.8"
      },
      "steps": [
        {
          "name": "Clean workspace",
          "run": "rm -rf \"${GITHUB_WORKSPACE}\"\nmkdir \"${GITHUB_WORKSPACE}\"\n"
        },
        {
          "name": "Set DOCKER_HOST",
          "run": "echo \"DOCKER_HOST=unix:///run/user/$(id -u)/docker.sock\" >> \"${GITHUB_ENV}\""
        },
        {
          "name": "Runner health check system info",
          "if": "always()",
          "run": "cat /etc/os-release || true\ncat /etc/apt/sources.list.d/rocm.list || true\ncat /opt/rocm/.info/version || true\nwhoami\n"
        },
        {
          "name": "Runner health check rocm-smi",
          "if": "always()",
          "run": "rocm-smi\n"
        },
        {
          "name": "Runner health check rocminfo",
          "if": "always()",
          "run": "rocminfo\n"
        },
        {
          "name": "Runner health check GPU count",
          "if": "always()",
          "run": "ngpu=$(rocminfo | grep -c -E 'Name:.*\\sgfx')\nif [[ \"x$ngpu\" != \"x2\" && \"x$ngpu\" != \"x4\" ]]; then\n    echo \"Failed to detect GPUs on the runner\"\n    exit 1\nfi\n"
        },
        {
          "name": "Runner health check disconnect on failure",
          "if": "${{ failure() }}",
          "run": "killall runsvc.sh\n"
        },
        {
          "name": "Preserve github env variables for use in docker",
          "run": "env | grep '^GITHUB' >> \"/tmp/github_env_${GITHUB_RUN_ID}\"\nenv | grep '^CI' >> \"/tmp/github_env_${GITHUB_RUN_ID}\"\n"
        },
        {
          "uses": "actions/download-artifact@v3",
          "name": "Download Build Artifacts",
          "with": {
            "name": "manywheel-py3_8-rocm5_1_1",
            "path": "${{ runner.temp }}/artifacts/"
          }
        },
        {
          "name": "Checkout PyTorch",
          "uses": "zhouzhuojie/checkout@05b13c9a0d21f08f6d5e64a1d5042246d13619d9",
          "with": {
            "ref": "${{ github.event_name == 'pull_request' && github.event.pull_request.head.sha || github.sha }}",
            "submodules": "recursive",
            "path": "pytorch"
          }
        },
        {
          "name": "Clean PyTorch checkout",
          "run": "# Remove any artifacts from the previous checkouts\ngit clean -fxd\n",
          "working-directory": "pytorch"
        },
        {
          "name": "Checkout pytorch/builder",
          "uses": "zhouzhuojie/checkout@05b13c9a0d21f08f6d5e64a1d5042246d13619d9",
          "with": {
            "ref": "main",
            "submodules": "recursive",
            "repository": "pytorch/builder",
            "path": "builder"
          }
        },
        {
          "name": "Clean pytorch/builder checkout",
          "run": "# Remove any artifacts from the previous checkouts\ngit clean -fxd\n",
          "working-directory": "builder"
        },
        {
          "name": "ROCm set GPU_FLAG",
          "run": "echo \"GPU_FLAG=--device=/dev/mem --device=/dev/kfd --device=/dev/dri --group-add video --group-add daemon\" >> \"${GITHUB_ENV}\"\n"
        },
        {
          "name": "Pull Docker image",
          "uses": "pytorch/test-infra/.github/actions/pull-docker-image@main",
          "with": {
            "docker-image": "pytorch/manylinux-builder:rocm5.1.1"
          }
        },
        {
          "name": "Test Pytorch binary",
          "uses": "./pytorch/.github/actions/test-pytorch-binary"
        },
        {
          "name": "Kill containers, clean up images",
          "if": "always()",
          "run": "# ignore expansion of \"docker ps -q\" since it could be empty\n# shellcheck disable=SC2046\ndocker stop $(docker ps -q) || true\n# Prune all of the docker images\ndocker system prune -af\n"
        }
      ]
    },
    "manywheel-py3_8-rocm5_1_1-upload": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_8-rocm5_1_1-test",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "rocm5.1.1",
        "GPU_ARCH_VERSION": "5.1.1",
        "GPU_ARCH_TYPE": "rocm",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:rocm5.1.1",
        "DESIRED_PYTHON": "3.8",
        "build_name": "manywheel-py3_8-rocm5_1_1"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}",
        "aws-access-key-id": "${{ secrets.AWS_PYTORCH_UPLOADER_ACCESS_KEY_ID }}",
        "aws-pytorch-uploader-secret-access-key": "${{ secrets.AWS_PYTORCH_UPLOADER_SECRET_ACCESS_KEY }}",
        "conda-pytorchbot-token": "${{ secrets.CONDA_PYTORCHBOT_TOKEN }}"
      },
      "uses": "./.github/workflows/_binary-upload.yml"
    },
    "manywheel-py3_8-rocm5_2-build": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "uses": "./.github/workflows/_binary-build-linux.yml",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "rocm5.2",
        "GPU_ARCH_VERSION": 5.2,
        "GPU_ARCH_TYPE": "rocm",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:rocm5.2",
        "DESIRED_PYTHON": "3.8",
        "build_name": "manywheel-py3_8-rocm5_2",
        "build_environment": "linux-binary-manywheel"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}"
      }
    },
    "manywheel-py3_8-rocm5_2-test": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_8-rocm5_2-build",
      "runs-on": "linux.rocm.gpu",
      "timeout-minutes": 240,
      "env": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "rocm5.2",
        "GPU_ARCH_VERSION": 5.2,
        "GPU_ARCH_TYPE": "rocm",
        "SKIP_ALL_TESTS": 1,
        "DOCKER_IMAGE": "pytorch/manylinux-builder:rocm5.2",
        "DESIRED_PYTHON": "3.8"
      },
      "steps": [
        {
          "name": "Clean workspace",
          "run": "rm -rf \"${GITHUB_WORKSPACE}\"\nmkdir \"${GITHUB_WORKSPACE}\"\n"
        },
        {
          "name": "Set DOCKER_HOST",
          "run": "echo \"DOCKER_HOST=unix:///run/user/$(id -u)/docker.sock\" >> \"${GITHUB_ENV}\""
        },
        {
          "name": "Runner health check system info",
          "if": "always()",
          "run": "cat /etc/os-release || true\ncat /etc/apt/sources.list.d/rocm.list || true\ncat /opt/rocm/.info/version || true\nwhoami\n"
        },
        {
          "name": "Runner health check rocm-smi",
          "if": "always()",
          "run": "rocm-smi\n"
        },
        {
          "name": "Runner health check rocminfo",
          "if": "always()",
          "run": "rocminfo\n"
        },
        {
          "name": "Runner health check GPU count",
          "if": "always()",
          "run": "ngpu=$(rocminfo | grep -c -E 'Name:.*\\sgfx')\nif [[ \"x$ngpu\" != \"x2\" && \"x$ngpu\" != \"x4\" ]]; then\n    echo \"Failed to detect GPUs on the runner\"\n    exit 1\nfi\n"
        },
        {
          "name": "Runner health check disconnect on failure",
          "if": "${{ failure() }}",
          "run": "killall runsvc.sh\n"
        },
        {
          "name": "Preserve github env variables for use in docker",
          "run": "env | grep '^GITHUB' >> \"/tmp/github_env_${GITHUB_RUN_ID}\"\nenv | grep '^CI' >> \"/tmp/github_env_${GITHUB_RUN_ID}\"\n"
        },
        {
          "uses": "actions/download-artifact@v3",
          "name": "Download Build Artifacts",
          "with": {
            "name": "manywheel-py3_8-rocm5_2",
            "path": "${{ runner.temp }}/artifacts/"
          }
        },
        {
          "name": "Checkout PyTorch",
          "uses": "zhouzhuojie/checkout@05b13c9a0d21f08f6d5e64a1d5042246d13619d9",
          "with": {
            "ref": "${{ github.event_name == 'pull_request' && github.event.pull_request.head.sha || github.sha }}",
            "submodules": "recursive",
            "path": "pytorch"
          }
        },
        {
          "name": "Clean PyTorch checkout",
          "run": "# Remove any artifacts from the previous checkouts\ngit clean -fxd\n",
          "working-directory": "pytorch"
        },
        {
          "name": "Checkout pytorch/builder",
          "uses": "zhouzhuojie/checkout@05b13c9a0d21f08f6d5e64a1d5042246d13619d9",
          "with": {
            "ref": "main",
            "submodules": "recursive",
            "repository": "pytorch/builder",
            "path": "builder"
          }
        },
        {
          "name": "Clean pytorch/builder checkout",
          "run": "# Remove any artifacts from the previous checkouts\ngit clean -fxd\n",
          "working-directory": "builder"
        },
        {
          "name": "ROCm set GPU_FLAG",
          "run": "echo \"GPU_FLAG=--device=/dev/mem --device=/dev/kfd --device=/dev/dri --group-add video --group-add daemon\" >> \"${GITHUB_ENV}\"\n"
        },
        {
          "name": "Pull Docker image",
          "uses": "pytorch/test-infra/.github/actions/pull-docker-image@main",
          "with": {
            "docker-image": "pytorch/manylinux-builder:rocm5.2"
          }
        },
        {
          "name": "Test Pytorch binary",
          "uses": "./pytorch/.github/actions/test-pytorch-binary"
        },
        {
          "name": "Kill containers, clean up images",
          "if": "always()",
          "run": "# ignore expansion of \"docker ps -q\" since it could be empty\n# shellcheck disable=SC2046\ndocker stop $(docker ps -q) || true\n# Prune all of the docker images\ndocker system prune -af\n"
        }
      ]
    },
    "manywheel-py3_8-rocm5_2-upload": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_8-rocm5_2-test",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "rocm5.2",
        "GPU_ARCH_VERSION": 5.2,
        "GPU_ARCH_TYPE": "rocm",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:rocm5.2",
        "DESIRED_PYTHON": "3.8",
        "build_name": "manywheel-py3_8-rocm5_2"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}",
        "aws-access-key-id": "${{ secrets.AWS_PYTORCH_UPLOADER_ACCESS_KEY_ID }}",
        "aws-pytorch-uploader-secret-access-key": "${{ secrets.AWS_PYTORCH_UPLOADER_SECRET_ACCESS_KEY }}",
        "conda-pytorchbot-token": "${{ secrets.CONDA_PYTORCHBOT_TOKEN }}"
      },
      "uses": "./.github/workflows/_binary-upload.yml"
    },
    "manywheel-py3_9-cpu-build": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "uses": "./.github/workflows/_binary-build-linux.yml",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cpu",
        "GPU_ARCH_TYPE": "cpu",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cpu",
        "DESIRED_PYTHON": "3.9",
        "build_name": "manywheel-py3_9-cpu",
        "build_environment": "linux-binary-manywheel"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}"
      }
    },
    "manywheel-py3_9-cpu-test": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_9-cpu-build",
      "uses": "./.github/workflows/_binary-test-linux.yml",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cpu",
        "GPU_ARCH_TYPE": "cpu",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cpu",
        "DESIRED_PYTHON": "3.9",
        "build_name": "manywheel-py3_9-cpu",
        "build_environment": "linux-binary-manywheel",
        "runs_on": "linux.4xlarge"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}"
      }
    },
    "manywheel-py3_9-cpu-upload": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_9-cpu-test",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cpu",
        "GPU_ARCH_TYPE": "cpu",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cpu",
        "DESIRED_PYTHON": "3.9",
        "build_name": "manywheel-py3_9-cpu"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}",
        "aws-access-key-id": "${{ secrets.AWS_PYTORCH_UPLOADER_ACCESS_KEY_ID }}",
        "aws-pytorch-uploader-secret-access-key": "${{ secrets.AWS_PYTORCH_UPLOADER_SECRET_ACCESS_KEY }}",
        "conda-pytorchbot-token": "${{ secrets.CONDA_PYTORCHBOT_TOKEN }}"
      },
      "uses": "./.github/workflows/_binary-upload.yml"
    },
    "manywheel-py3_9-cuda11_6-build": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "uses": "./.github/workflows/_binary-build-linux.yml",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cu116",
        "GPU_ARCH_VERSION": 11.6,
        "GPU_ARCH_TYPE": "cuda",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cuda11.6",
        "DESIRED_PYTHON": "3.9",
        "build_name": "manywheel-py3_9-cuda11_6",
        "build_environment": "linux-binary-manywheel"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}"
      }
    },
    "manywheel-py3_9-cuda11_6-test": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_9-cuda11_6-build",
      "uses": "./.github/workflows/_binary-test-linux.yml",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cu116",
        "GPU_ARCH_VERSION": 11.6,
        "GPU_ARCH_TYPE": "cuda",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cuda11.6",
        "DESIRED_PYTHON": "3.9",
        "build_name": "manywheel-py3_9-cuda11_6",
        "build_environment": "linux-binary-manywheel",
        "runs_on": "linux.4xlarge.nvidia.gpu"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}"
      }
    },
    "manywheel-py3_9-cuda11_6-upload": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_9-cuda11_6-test",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cu116",
        "GPU_ARCH_VERSION": 11.6,
        "GPU_ARCH_TYPE": "cuda",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cuda11.6",
        "DESIRED_PYTHON": "3.9",
        "build_name": "manywheel-py3_9-cuda11_6"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}",
        "aws-access-key-id": "${{ secrets.AWS_PYTORCH_UPLOADER_ACCESS_KEY_ID }}",
        "aws-pytorch-uploader-secret-access-key": "${{ secrets.AWS_PYTORCH_UPLOADER_SECRET_ACCESS_KEY }}",
        "conda-pytorchbot-token": "${{ secrets.CONDA_PYTORCHBOT_TOKEN }}"
      },
      "uses": "./.github/workflows/_binary-upload.yml"
    },
    "manywheel-py3_9-cuda11_7-with-pypi-cudnn-build": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "uses": "./.github/workflows/_binary-build-linux.yml",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cu117",
        "GPU_ARCH_VERSION": 11.7,
        "GPU_ARCH_TYPE": "cuda",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cuda11.7",
        "DESIRED_PYTHON": "3.9",
        "build_name": "manywheel-py3_9-cuda11_7-with-pypi-cudnn",
        "build_environment": "linux-binary-manywheel",
        "PYTORCH_EXTRA_INSTALL_REQUIREMENTS": "nvidia-cuda-runtime-cu11;nvidia-cudnn-cu11==8.5.0.96;nvidia-cublas-cu11==11.10.3.66"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}"
      }
    },
    "manywheel-py3_9-cuda11_7-with-pypi-cudnn-test": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_9-cuda11_7-with-pypi-cudnn-build",
      "uses": "./.github/workflows/_binary-test-linux.yml",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cu117",
        "GPU_ARCH_VERSION": 11.7,
        "GPU_ARCH_TYPE": "cuda",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cuda11.7",
        "DESIRED_PYTHON": "3.9",
        "build_name": "manywheel-py3_9-cuda11_7-with-pypi-cudnn",
        "build_environment": "linux-binary-manywheel",
        "runs_on": "linux.4xlarge.nvidia.gpu"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}"
      }
    },
    "manywheel-py3_9-cuda11_7-with-pypi-cudnn-upload": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_9-cuda11_7-with-pypi-cudnn-test",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cu117",
        "GPU_ARCH_VERSION": 11.7,
        "GPU_ARCH_TYPE": "cuda",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cuda11.7",
        "DESIRED_PYTHON": "3.9",
        "build_name": "manywheel-py3_9-cuda11_7-with-pypi-cudnn"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}",
        "aws-access-key-id": "${{ secrets.AWS_PYTORCH_UPLOADER_ACCESS_KEY_ID }}",
        "aws-pytorch-uploader-secret-access-key": "${{ secrets.AWS_PYTORCH_UPLOADER_SECRET_ACCESS_KEY }}",
        "conda-pytorchbot-token": "${{ secrets.CONDA_PYTORCHBOT_TOKEN }}"
      },
      "uses": "./.github/workflows/_binary-upload.yml"
    },
    "manywheel-py3_9-cuda11_7-build": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "uses": "./.github/workflows/_binary-build-linux.yml",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cu117",
        "GPU_ARCH_VERSION": 11.7,
        "GPU_ARCH_TYPE": "cuda",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cuda11.7",
        "DESIRED_PYTHON": "3.9",
        "build_name": "manywheel-py3_9-cuda11_7",
        "build_environment": "linux-binary-manywheel"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}"
      }
    },
    "manywheel-py3_9-cuda11_7-test": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_9-cuda11_7-build",
      "uses": "./.github/workflows/_binary-test-linux.yml",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cu117",
        "GPU_ARCH_VERSION": 11.7,
        "GPU_ARCH_TYPE": "cuda",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cuda11.7",
        "DESIRED_PYTHON": "3.9",
        "build_name": "manywheel-py3_9-cuda11_7",
        "build_environment": "linux-binary-manywheel",
        "runs_on": "linux.4xlarge.nvidia.gpu"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}"
      }
    },
    "manywheel-py3_9-cuda11_7-upload": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_9-cuda11_7-test",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cu117",
        "GPU_ARCH_VERSION": 11.7,
        "GPU_ARCH_TYPE": "cuda",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cuda11.7",
        "DESIRED_PYTHON": "3.9",
        "build_name": "manywheel-py3_9-cuda11_7"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}",
        "aws-access-key-id": "${{ secrets.AWS_PYTORCH_UPLOADER_ACCESS_KEY_ID }}",
        "aws-pytorch-uploader-secret-access-key": "${{ secrets.AWS_PYTORCH_UPLOADER_SECRET_ACCESS_KEY }}",
        "conda-pytorchbot-token": "${{ secrets.CONDA_PYTORCHBOT_TOKEN }}"
      },
      "uses": "./.github/workflows/_binary-upload.yml"
    },
    "manywheel-py3_9-rocm5_1_1-build": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "uses": "./.github/workflows/_binary-build-linux.yml",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "rocm5.1.1",
        "GPU_ARCH_VERSION": "5.1.1",
        "GPU_ARCH_TYPE": "rocm",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:rocm5.1.1",
        "DESIRED_PYTHON": "3.9",
        "build_name": "manywheel-py3_9-rocm5_1_1",
        "build_environment": "linux-binary-manywheel"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}"
      }
    },
    "manywheel-py3_9-rocm5_1_1-test": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_9-rocm5_1_1-build",
      "runs-on": "linux.rocm.gpu",
      "timeout-minutes": 240,
      "env": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "rocm5.1.1",
        "GPU_ARCH_VERSION": "5.1.1",
        "GPU_ARCH_TYPE": "rocm",
        "SKIP_ALL_TESTS": 1,
        "DOCKER_IMAGE": "pytorch/manylinux-builder:rocm5.1.1",
        "DESIRED_PYTHON": "3.9"
      },
      "steps": [
        {
          "name": "Clean workspace",
          "run": "rm -rf \"${GITHUB_WORKSPACE}\"\nmkdir \"${GITHUB_WORKSPACE}\"\n"
        },
        {
          "name": "Set DOCKER_HOST",
          "run": "echo \"DOCKER_HOST=unix:///run/user/$(id -u)/docker.sock\" >> \"${GITHUB_ENV}\""
        },
        {
          "name": "Runner health check system info",
          "if": "always()",
          "run": "cat /etc/os-release || true\ncat /etc/apt/sources.list.d/rocm.list || true\ncat /opt/rocm/.info/version || true\nwhoami\n"
        },
        {
          "name": "Runner health check rocm-smi",
          "if": "always()",
          "run": "rocm-smi\n"
        },
        {
          "name": "Runner health check rocminfo",
          "if": "always()",
          "run": "rocminfo\n"
        },
        {
          "name": "Runner health check GPU count",
          "if": "always()",
          "run": "ngpu=$(rocminfo | grep -c -E 'Name:.*\\sgfx')\nif [[ \"x$ngpu\" != \"x2\" && \"x$ngpu\" != \"x4\" ]]; then\n    echo \"Failed to detect GPUs on the runner\"\n    exit 1\nfi\n"
        },
        {
          "name": "Runner health check disconnect on failure",
          "if": "${{ failure() }}",
          "run": "killall runsvc.sh\n"
        },
        {
          "name": "Preserve github env variables for use in docker",
          "run": "env | grep '^GITHUB' >> \"/tmp/github_env_${GITHUB_RUN_ID}\"\nenv | grep '^CI' >> \"/tmp/github_env_${GITHUB_RUN_ID}\"\n"
        },
        {
          "uses": "actions/download-artifact@v3",
          "name": "Download Build Artifacts",
          "with": {
            "name": "manywheel-py3_9-rocm5_1_1",
            "path": "${{ runner.temp }}/artifacts/"
          }
        },
        {
          "name": "Checkout PyTorch",
          "uses": "zhouzhuojie/checkout@05b13c9a0d21f08f6d5e64a1d5042246d13619d9",
          "with": {
            "ref": "${{ github.event_name == 'pull_request' && github.event.pull_request.head.sha || github.sha }}",
            "submodules": "recursive",
            "path": "pytorch"
          }
        },
        {
          "name": "Clean PyTorch checkout",
          "run": "# Remove any artifacts from the previous checkouts\ngit clean -fxd\n",
          "working-directory": "pytorch"
        },
        {
          "name": "Checkout pytorch/builder",
          "uses": "zhouzhuojie/checkout@05b13c9a0d21f08f6d5e64a1d5042246d13619d9",
          "with": {
            "ref": "main",
            "submodules": "recursive",
            "repository": "pytorch/builder",
            "path": "builder"
          }
        },
        {
          "name": "Clean pytorch/builder checkout",
          "run": "# Remove any artifacts from the previous checkouts\ngit clean -fxd\n",
          "working-directory": "builder"
        },
        {
          "name": "ROCm set GPU_FLAG",
          "run": "echo \"GPU_FLAG=--device=/dev/mem --device=/dev/kfd --device=/dev/dri --group-add video --group-add daemon\" >> \"${GITHUB_ENV}\"\n"
        },
        {
          "name": "Pull Docker image",
          "uses": "pytorch/test-infra/.github/actions/pull-docker-image@main",
          "with": {
            "docker-image": "pytorch/manylinux-builder:rocm5.1.1"
          }
        },
        {
          "name": "Test Pytorch binary",
          "uses": "./pytorch/.github/actions/test-pytorch-binary"
        },
        {
          "name": "Kill containers, clean up images",
          "if": "always()",
          "run": "# ignore expansion of \"docker ps -q\" since it could be empty\n# shellcheck disable=SC2046\ndocker stop $(docker ps -q) || true\n# Prune all of the docker images\ndocker system prune -af\n"
        }
      ]
    },
    "manywheel-py3_9-rocm5_1_1-upload": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_9-rocm5_1_1-test",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "rocm5.1.1",
        "GPU_ARCH_VERSION": "5.1.1",
        "GPU_ARCH_TYPE": "rocm",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:rocm5.1.1",
        "DESIRED_PYTHON": "3.9",
        "build_name": "manywheel-py3_9-rocm5_1_1"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}",
        "aws-access-key-id": "${{ secrets.AWS_PYTORCH_UPLOADER_ACCESS_KEY_ID }}",
        "aws-pytorch-uploader-secret-access-key": "${{ secrets.AWS_PYTORCH_UPLOADER_SECRET_ACCESS_KEY }}",
        "conda-pytorchbot-token": "${{ secrets.CONDA_PYTORCHBOT_TOKEN }}"
      },
      "uses": "./.github/workflows/_binary-upload.yml"
    },
    "manywheel-py3_9-rocm5_2-build": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "uses": "./.github/workflows/_binary-build-linux.yml",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "rocm5.2",
        "GPU_ARCH_VERSION": 5.2,
        "GPU_ARCH_TYPE": "rocm",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:rocm5.2",
        "DESIRED_PYTHON": "3.9",
        "build_name": "manywheel-py3_9-rocm5_2",
        "build_environment": "linux-binary-manywheel"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}"
      }
    },
    "manywheel-py3_9-rocm5_2-test": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_9-rocm5_2-build",
      "runs-on": "linux.rocm.gpu",
      "timeout-minutes": 240,
      "env": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "rocm5.2",
        "GPU_ARCH_VERSION": 5.2,
        "GPU_ARCH_TYPE": "rocm",
        "SKIP_ALL_TESTS": 1,
        "DOCKER_IMAGE": "pytorch/manylinux-builder:rocm5.2",
        "DESIRED_PYTHON": "3.9"
      },
      "steps": [
        {
          "name": "Clean workspace",
          "run": "rm -rf \"${GITHUB_WORKSPACE}\"\nmkdir \"${GITHUB_WORKSPACE}\"\n"
        },
        {
          "name": "Set DOCKER_HOST",
          "run": "echo \"DOCKER_HOST=unix:///run/user/$(id -u)/docker.sock\" >> \"${GITHUB_ENV}\""
        },
        {
          "name": "Runner health check system info",
          "if": "always()",
          "run": "cat /etc/os-release || true\ncat /etc/apt/sources.list.d/rocm.list || true\ncat /opt/rocm/.info/version || true\nwhoami\n"
        },
        {
          "name": "Runner health check rocm-smi",
          "if": "always()",
          "run": "rocm-smi\n"
        },
        {
          "name": "Runner health check rocminfo",
          "if": "always()",
          "run": "rocminfo\n"
        },
        {
          "name": "Runner health check GPU count",
          "if": "always()",
          "run": "ngpu=$(rocminfo | grep -c -E 'Name:.*\\sgfx')\nif [[ \"x$ngpu\" != \"x2\" && \"x$ngpu\" != \"x4\" ]]; then\n    echo \"Failed to detect GPUs on the runner\"\n    exit 1\nfi\n"
        },
        {
          "name": "Runner health check disconnect on failure",
          "if": "${{ failure() }}",
          "run": "killall runsvc.sh\n"
        },
        {
          "name": "Preserve github env variables for use in docker",
          "run": "env | grep '^GITHUB' >> \"/tmp/github_env_${GITHUB_RUN_ID}\"\nenv | grep '^CI' >> \"/tmp/github_env_${GITHUB_RUN_ID}\"\n"
        },
        {
          "uses": "actions/download-artifact@v3",
          "name": "Download Build Artifacts",
          "with": {
            "name": "manywheel-py3_9-rocm5_2",
            "path": "${{ runner.temp }}/artifacts/"
          }
        },
        {
          "name": "Checkout PyTorch",
          "uses": "zhouzhuojie/checkout@05b13c9a0d21f08f6d5e64a1d5042246d13619d9",
          "with": {
            "ref": "${{ github.event_name == 'pull_request' && github.event.pull_request.head.sha || github.sha }}",
            "submodules": "recursive",
            "path": "pytorch"
          }
        },
        {
          "name": "Clean PyTorch checkout",
          "run": "# Remove any artifacts from the previous checkouts\ngit clean -fxd\n",
          "working-directory": "pytorch"
        },
        {
          "name": "Checkout pytorch/builder",
          "uses": "zhouzhuojie/checkout@05b13c9a0d21f08f6d5e64a1d5042246d13619d9",
          "with": {
            "ref": "main",
            "submodules": "recursive",
            "repository": "pytorch/builder",
            "path": "builder"
          }
        },
        {
          "name": "Clean pytorch/builder checkout",
          "run": "# Remove any artifacts from the previous checkouts\ngit clean -fxd\n",
          "working-directory": "builder"
        },
        {
          "name": "ROCm set GPU_FLAG",
          "run": "echo \"GPU_FLAG=--device=/dev/mem --device=/dev/kfd --device=/dev/dri --group-add video --group-add daemon\" >> \"${GITHUB_ENV}\"\n"
        },
        {
          "name": "Pull Docker image",
          "uses": "pytorch/test-infra/.github/actions/pull-docker-image@main",
          "with": {
            "docker-image": "pytorch/manylinux-builder:rocm5.2"
          }
        },
        {
          "name": "Test Pytorch binary",
          "uses": "./pytorch/.github/actions/test-pytorch-binary"
        },
        {
          "name": "Kill containers, clean up images",
          "if": "always()",
          "run": "# ignore expansion of \"docker ps -q\" since it could be empty\n# shellcheck disable=SC2046\ndocker stop $(docker ps -q) || true\n# Prune all of the docker images\ndocker system prune -af\n"
        }
      ]
    },
    "manywheel-py3_9-rocm5_2-upload": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_9-rocm5_2-test",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "rocm5.2",
        "GPU_ARCH_VERSION": 5.2,
        "GPU_ARCH_TYPE": "rocm",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:rocm5.2",
        "DESIRED_PYTHON": "3.9",
        "build_name": "manywheel-py3_9-rocm5_2"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}",
        "aws-access-key-id": "${{ secrets.AWS_PYTORCH_UPLOADER_ACCESS_KEY_ID }}",
        "aws-pytorch-uploader-secret-access-key": "${{ secrets.AWS_PYTORCH_UPLOADER_SECRET_ACCESS_KEY }}",
        "conda-pytorchbot-token": "${{ secrets.CONDA_PYTORCHBOT_TOKEN }}"
      },
      "uses": "./.github/workflows/_binary-upload.yml"
    },
    "manywheel-py3_10-cpu-build": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "uses": "./.github/workflows/_binary-build-linux.yml",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cpu",
        "GPU_ARCH_TYPE": "cpu",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cpu",
        "DESIRED_PYTHON": "3.10",
        "build_name": "manywheel-py3_10-cpu",
        "build_environment": "linux-binary-manywheel"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}"
      }
    },
    "manywheel-py3_10-cpu-test": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_10-cpu-build",
      "uses": "./.github/workflows/_binary-test-linux.yml",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cpu",
        "GPU_ARCH_TYPE": "cpu",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cpu",
        "DESIRED_PYTHON": "3.10",
        "build_name": "manywheel-py3_10-cpu",
        "build_environment": "linux-binary-manywheel",
        "runs_on": "linux.4xlarge"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}"
      }
    },
    "manywheel-py3_10-cpu-upload": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_10-cpu-test",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cpu",
        "GPU_ARCH_TYPE": "cpu",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cpu",
        "DESIRED_PYTHON": "3.10",
        "build_name": "manywheel-py3_10-cpu"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}",
        "aws-access-key-id": "${{ secrets.AWS_PYTORCH_UPLOADER_ACCESS_KEY_ID }}",
        "aws-pytorch-uploader-secret-access-key": "${{ secrets.AWS_PYTORCH_UPLOADER_SECRET_ACCESS_KEY }}",
        "conda-pytorchbot-token": "${{ secrets.CONDA_PYTORCHBOT_TOKEN }}"
      },
      "uses": "./.github/workflows/_binary-upload.yml"
    },
    "manywheel-py3_10-cuda11_6-build": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "uses": "./.github/workflows/_binary-build-linux.yml",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cu116",
        "GPU_ARCH_VERSION": 11.6,
        "GPU_ARCH_TYPE": "cuda",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cuda11.6",
        "DESIRED_PYTHON": "3.10",
        "build_name": "manywheel-py3_10-cuda11_6",
        "build_environment": "linux-binary-manywheel"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}"
      }
    },
    "manywheel-py3_10-cuda11_6-test": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_10-cuda11_6-build",
      "uses": "./.github/workflows/_binary-test-linux.yml",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cu116",
        "GPU_ARCH_VERSION": 11.6,
        "GPU_ARCH_TYPE": "cuda",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cuda11.6",
        "DESIRED_PYTHON": "3.10",
        "build_name": "manywheel-py3_10-cuda11_6",
        "build_environment": "linux-binary-manywheel",
        "runs_on": "linux.4xlarge.nvidia.gpu"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}"
      }
    },
    "manywheel-py3_10-cuda11_6-upload": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_10-cuda11_6-test",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cu116",
        "GPU_ARCH_VERSION": 11.6,
        "GPU_ARCH_TYPE": "cuda",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cuda11.6",
        "DESIRED_PYTHON": "3.10",
        "build_name": "manywheel-py3_10-cuda11_6"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}",
        "aws-access-key-id": "${{ secrets.AWS_PYTORCH_UPLOADER_ACCESS_KEY_ID }}",
        "aws-pytorch-uploader-secret-access-key": "${{ secrets.AWS_PYTORCH_UPLOADER_SECRET_ACCESS_KEY }}",
        "conda-pytorchbot-token": "${{ secrets.CONDA_PYTORCHBOT_TOKEN }}"
      },
      "uses": "./.github/workflows/_binary-upload.yml"
    },
    "manywheel-py3_10-cuda11_7-with-pypi-cudnn-build": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "uses": "./.github/workflows/_binary-build-linux.yml",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cu117",
        "GPU_ARCH_VERSION": 11.7,
        "GPU_ARCH_TYPE": "cuda",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cuda11.7",
        "DESIRED_PYTHON": "3.10",
        "build_name": "manywheel-py3_10-cuda11_7-with-pypi-cudnn",
        "build_environment": "linux-binary-manywheel",
        "PYTORCH_EXTRA_INSTALL_REQUIREMENTS": "nvidia-cuda-runtime-cu11;nvidia-cudnn-cu11==8.5.0.96;nvidia-cublas-cu11==11.10.3.66"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}"
      }
    },
    "manywheel-py3_10-cuda11_7-with-pypi-cudnn-test": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_10-cuda11_7-with-pypi-cudnn-build",
      "uses": "./.github/workflows/_binary-test-linux.yml",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cu117",
        "GPU_ARCH_VERSION": 11.7,
        "GPU_ARCH_TYPE": "cuda",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cuda11.7",
        "DESIRED_PYTHON": "3.10",
        "build_name": "manywheel-py3_10-cuda11_7-with-pypi-cudnn",
        "build_environment": "linux-binary-manywheel",
        "runs_on": "linux.4xlarge.nvidia.gpu"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}"
      }
    },
    "manywheel-py3_10-cuda11_7-with-pypi-cudnn-upload": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_10-cuda11_7-with-pypi-cudnn-test",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cu117",
        "GPU_ARCH_VERSION": 11.7,
        "GPU_ARCH_TYPE": "cuda",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cuda11.7",
        "DESIRED_PYTHON": "3.10",
        "build_name": "manywheel-py3_10-cuda11_7-with-pypi-cudnn"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}",
        "aws-access-key-id": "${{ secrets.AWS_PYTORCH_UPLOADER_ACCESS_KEY_ID }}",
        "aws-pytorch-uploader-secret-access-key": "${{ secrets.AWS_PYTORCH_UPLOADER_SECRET_ACCESS_KEY }}",
        "conda-pytorchbot-token": "${{ secrets.CONDA_PYTORCHBOT_TOKEN }}"
      },
      "uses": "./.github/workflows/_binary-upload.yml"
    },
    "manywheel-py3_10-cuda11_7-build": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "uses": "./.github/workflows/_binary-build-linux.yml",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cu117",
        "GPU_ARCH_VERSION": 11.7,
        "GPU_ARCH_TYPE": "cuda",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cuda11.7",
        "DESIRED_PYTHON": "3.10",
        "build_name": "manywheel-py3_10-cuda11_7",
        "build_environment": "linux-binary-manywheel"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}"
      }
    },
    "manywheel-py3_10-cuda11_7-test": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_10-cuda11_7-build",
      "uses": "./.github/workflows/_binary-test-linux.yml",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cu117",
        "GPU_ARCH_VERSION": 11.7,
        "GPU_ARCH_TYPE": "cuda",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cuda11.7",
        "DESIRED_PYTHON": "3.10",
        "build_name": "manywheel-py3_10-cuda11_7",
        "build_environment": "linux-binary-manywheel",
        "runs_on": "linux.4xlarge.nvidia.gpu"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}"
      }
    },
    "manywheel-py3_10-cuda11_7-upload": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_10-cuda11_7-test",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cu117",
        "GPU_ARCH_VERSION": 11.7,
        "GPU_ARCH_TYPE": "cuda",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cuda11.7",
        "DESIRED_PYTHON": "3.10",
        "build_name": "manywheel-py3_10-cuda11_7"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}",
        "aws-access-key-id": "${{ secrets.AWS_PYTORCH_UPLOADER_ACCESS_KEY_ID }}",
        "aws-pytorch-uploader-secret-access-key": "${{ secrets.AWS_PYTORCH_UPLOADER_SECRET_ACCESS_KEY }}",
        "conda-pytorchbot-token": "${{ secrets.CONDA_PYTORCHBOT_TOKEN }}"
      },
      "uses": "./.github/workflows/_binary-upload.yml"
    },
    "manywheel-py3_10-rocm5_1_1-build": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "uses": "./.github/workflows/_binary-build-linux.yml",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "rocm5.1.1",
        "GPU_ARCH_VERSION": "5.1.1",
        "GPU_ARCH_TYPE": "rocm",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:rocm5.1.1",
        "DESIRED_PYTHON": "3.10",
        "build_name": "manywheel-py3_10-rocm5_1_1",
        "build_environment": "linux-binary-manywheel"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}"
      }
    },
    "manywheel-py3_10-rocm5_1_1-test": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_10-rocm5_1_1-build",
      "runs-on": "linux.rocm.gpu",
      "timeout-minutes": 240,
      "env": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "rocm5.1.1",
        "GPU_ARCH_VERSION": "5.1.1",
        "GPU_ARCH_TYPE": "rocm",
        "SKIP_ALL_TESTS": 1,
        "DOCKER_IMAGE": "pytorch/manylinux-builder:rocm5.1.1",
        "DESIRED_PYTHON": "3.10"
      },
      "steps": [
        {
          "name": "Clean workspace",
          "run": "rm -rf \"${GITHUB_WORKSPACE}\"\nmkdir \"${GITHUB_WORKSPACE}\"\n"
        },
        {
          "name": "Set DOCKER_HOST",
          "run": "echo \"DOCKER_HOST=unix:///run/user/$(id -u)/docker.sock\" >> \"${GITHUB_ENV}\""
        },
        {
          "name": "Runner health check system info",
          "if": "always()",
          "run": "cat /etc/os-release || true\ncat /etc/apt/sources.list.d/rocm.list || true\ncat /opt/rocm/.info/version || true\nwhoami\n"
        },
        {
          "name": "Runner health check rocm-smi",
          "if": "always()",
          "run": "rocm-smi\n"
        },
        {
          "name": "Runner health check rocminfo",
          "if": "always()",
          "run": "rocminfo\n"
        },
        {
          "name": "Runner health check GPU count",
          "if": "always()",
          "run": "ngpu=$(rocminfo | grep -c -E 'Name:.*\\sgfx')\nif [[ \"x$ngpu\" != \"x2\" && \"x$ngpu\" != \"x4\" ]]; then\n    echo \"Failed to detect GPUs on the runner\"\n    exit 1\nfi\n"
        },
        {
          "name": "Runner health check disconnect on failure",
          "if": "${{ failure() }}",
          "run": "killall runsvc.sh\n"
        },
        {
          "name": "Preserve github env variables for use in docker",
          "run": "env | grep '^GITHUB' >> \"/tmp/github_env_${GITHUB_RUN_ID}\"\nenv | grep '^CI' >> \"/tmp/github_env_${GITHUB_RUN_ID}\"\n"
        },
        {
          "uses": "actions/download-artifact@v3",
          "name": "Download Build Artifacts",
          "with": {
            "name": "manywheel-py3_10-rocm5_1_1",
            "path": "${{ runner.temp }}/artifacts/"
          }
        },
        {
          "name": "Checkout PyTorch",
          "uses": "zhouzhuojie/checkout@05b13c9a0d21f08f6d5e64a1d5042246d13619d9",
          "with": {
            "ref": "${{ github.event_name == 'pull_request' && github.event.pull_request.head.sha || github.sha }}",
            "submodules": "recursive",
            "path": "pytorch"
          }
        },
        {
          "name": "Clean PyTorch checkout",
          "run": "# Remove any artifacts from the previous checkouts\ngit clean -fxd\n",
          "working-directory": "pytorch"
        },
        {
          "name": "Checkout pytorch/builder",
          "uses": "zhouzhuojie/checkout@05b13c9a0d21f08f6d5e64a1d5042246d13619d9",
          "with": {
            "ref": "main",
            "submodules": "recursive",
            "repository": "pytorch/builder",
            "path": "builder"
          }
        },
        {
          "name": "Clean pytorch/builder checkout",
          "run": "# Remove any artifacts from the previous checkouts\ngit clean -fxd\n",
          "working-directory": "builder"
        },
        {
          "name": "ROCm set GPU_FLAG",
          "run": "echo \"GPU_FLAG=--device=/dev/mem --device=/dev/kfd --device=/dev/dri --group-add video --group-add daemon\" >> \"${GITHUB_ENV}\"\n"
        },
        {
          "name": "Pull Docker image",
          "uses": "pytorch/test-infra/.github/actions/pull-docker-image@main",
          "with": {
            "docker-image": "pytorch/manylinux-builder:rocm5.1.1"
          }
        },
        {
          "name": "Test Pytorch binary",
          "uses": "./pytorch/.github/actions/test-pytorch-binary"
        },
        {
          "name": "Kill containers, clean up images",
          "if": "always()",
          "run": "# ignore expansion of \"docker ps -q\" since it could be empty\n# shellcheck disable=SC2046\ndocker stop $(docker ps -q) || true\n# Prune all of the docker images\ndocker system prune -af\n"
        }
      ]
    },
    "manywheel-py3_10-rocm5_1_1-upload": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_10-rocm5_1_1-test",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "rocm5.1.1",
        "GPU_ARCH_VERSION": "5.1.1",
        "GPU_ARCH_TYPE": "rocm",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:rocm5.1.1",
        "DESIRED_PYTHON": "3.10",
        "build_name": "manywheel-py3_10-rocm5_1_1"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}",
        "aws-access-key-id": "${{ secrets.AWS_PYTORCH_UPLOADER_ACCESS_KEY_ID }}",
        "aws-pytorch-uploader-secret-access-key": "${{ secrets.AWS_PYTORCH_UPLOADER_SECRET_ACCESS_KEY }}",
        "conda-pytorchbot-token": "${{ secrets.CONDA_PYTORCHBOT_TOKEN }}"
      },
      "uses": "./.github/workflows/_binary-upload.yml"
    },
    "manywheel-py3_10-rocm5_2-build": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "uses": "./.github/workflows/_binary-build-linux.yml",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "rocm5.2",
        "GPU_ARCH_VERSION": 5.2,
        "GPU_ARCH_TYPE": "rocm",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:rocm5.2",
        "DESIRED_PYTHON": "3.10",
        "build_name": "manywheel-py3_10-rocm5_2",
        "build_environment": "linux-binary-manywheel"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}"
      }
    },
    "manywheel-py3_10-rocm5_2-test": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_10-rocm5_2-build",
      "runs-on": "linux.rocm.gpu",
      "timeout-minutes": 240,
      "env": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "rocm5.2",
        "GPU_ARCH_VERSION": 5.2,
        "GPU_ARCH_TYPE": "rocm",
        "SKIP_ALL_TESTS": 1,
        "DOCKER_IMAGE": "pytorch/manylinux-builder:rocm5.2",
        "DESIRED_PYTHON": "3.10"
      },
      "steps": [
        {
          "name": "Clean workspace",
          "run": "rm -rf \"${GITHUB_WORKSPACE}\"\nmkdir \"${GITHUB_WORKSPACE}\"\n"
        },
        {
          "name": "Set DOCKER_HOST",
          "run": "echo \"DOCKER_HOST=unix:///run/user/$(id -u)/docker.sock\" >> \"${GITHUB_ENV}\""
        },
        {
          "name": "Runner health check system info",
          "if": "always()",
          "run": "cat /etc/os-release || true\ncat /etc/apt/sources.list.d/rocm.list || true\ncat /opt/rocm/.info/version || true\nwhoami\n"
        },
        {
          "name": "Runner health check rocm-smi",
          "if": "always()",
          "run": "rocm-smi\n"
        },
        {
          "name": "Runner health check rocminfo",
          "if": "always()",
          "run": "rocminfo\n"
        },
        {
          "name": "Runner health check GPU count",
          "if": "always()",
          "run": "ngpu=$(rocminfo | grep -c -E 'Name:.*\\sgfx')\nif [[ \"x$ngpu\" != \"x2\" && \"x$ngpu\" != \"x4\" ]]; then\n    echo \"Failed to detect GPUs on the runner\"\n    exit 1\nfi\n"
        },
        {
          "name": "Runner health check disconnect on failure",
          "if": "${{ failure() }}",
          "run": "killall runsvc.sh\n"
        },
        {
          "name": "Preserve github env variables for use in docker",
          "run": "env | grep '^GITHUB' >> \"/tmp/github_env_${GITHUB_RUN_ID}\"\nenv | grep '^CI' >> \"/tmp/github_env_${GITHUB_RUN_ID}\"\n"
        },
        {
          "uses": "actions/download-artifact@v3",
          "name": "Download Build Artifacts",
          "with": {
            "name": "manywheel-py3_10-rocm5_2",
            "path": "${{ runner.temp }}/artifacts/"
          }
        },
        {
          "name": "Checkout PyTorch",
          "uses": "zhouzhuojie/checkout@05b13c9a0d21f08f6d5e64a1d5042246d13619d9",
          "with": {
            "ref": "${{ github.event_name == 'pull_request' && github.event.pull_request.head.sha || github.sha }}",
            "submodules": "recursive",
            "path": "pytorch"
          }
        },
        {
          "name": "Clean PyTorch checkout",
          "run": "# Remove any artifacts from the previous checkouts\ngit clean -fxd\n",
          "working-directory": "pytorch"
        },
        {
          "name": "Checkout pytorch/builder",
          "uses": "zhouzhuojie/checkout@05b13c9a0d21f08f6d5e64a1d5042246d13619d9",
          "with": {
            "ref": "main",
            "submodules": "recursive",
            "repository": "pytorch/builder",
            "path": "builder"
          }
        },
        {
          "name": "Clean pytorch/builder checkout",
          "run": "# Remove any artifacts from the previous checkouts\ngit clean -fxd\n",
          "working-directory": "builder"
        },
        {
          "name": "ROCm set GPU_FLAG",
          "run": "echo \"GPU_FLAG=--device=/dev/mem --device=/dev/kfd --device=/dev/dri --group-add video --group-add daemon\" >> \"${GITHUB_ENV}\"\n"
        },
        {
          "name": "Pull Docker image",
          "uses": "pytorch/test-infra/.github/actions/pull-docker-image@main",
          "with": {
            "docker-image": "pytorch/manylinux-builder:rocm5.2"
          }
        },
        {
          "name": "Test Pytorch binary",
          "uses": "./pytorch/.github/actions/test-pytorch-binary"
        },
        {
          "name": "Kill containers, clean up images",
          "if": "always()",
          "run": "# ignore expansion of \"docker ps -q\" since it could be empty\n# shellcheck disable=SC2046\ndocker stop $(docker ps -q) || true\n# Prune all of the docker images\ndocker system prune -af\n"
        }
      ]
    },
    "manywheel-py3_10-rocm5_2-upload": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_10-rocm5_2-test",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "rocm5.2",
        "GPU_ARCH_VERSION": 5.2,
        "GPU_ARCH_TYPE": "rocm",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:rocm5.2",
        "DESIRED_PYTHON": "3.10",
        "build_name": "manywheel-py3_10-rocm5_2"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}",
        "aws-access-key-id": "${{ secrets.AWS_PYTORCH_UPLOADER_ACCESS_KEY_ID }}",
        "aws-pytorch-uploader-secret-access-key": "${{ secrets.AWS_PYTORCH_UPLOADER_SECRET_ACCESS_KEY }}",
        "conda-pytorchbot-token": "${{ secrets.CONDA_PYTORCHBOT_TOKEN }}"
      },
      "uses": "./.github/workflows/_binary-upload.yml"
    },
    "manywheel-py3_11-cpu-build": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "uses": "./.github/workflows/_binary-build-linux.yml",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cpu",
        "GPU_ARCH_TYPE": "cpu",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cpu",
        "DESIRED_PYTHON": "3.11",
        "build_name": "manywheel-py3_11-cpu",
        "build_environment": "linux-binary-manywheel"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}"
      }
    },
    "manywheel-py3_11-cpu-test": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_11-cpu-build",
      "uses": "./.github/workflows/_binary-test-linux.yml",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cpu",
        "GPU_ARCH_TYPE": "cpu",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cpu",
        "DESIRED_PYTHON": "3.11",
        "build_name": "manywheel-py3_11-cpu",
        "build_environment": "linux-binary-manywheel",
        "runs_on": "linux.4xlarge"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}"
      }
    },
    "manywheel-py3_11-cpu-upload": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_11-cpu-test",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cpu",
        "GPU_ARCH_TYPE": "cpu",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cpu",
        "DESIRED_PYTHON": "3.11",
        "build_name": "manywheel-py3_11-cpu"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}",
        "aws-access-key-id": "${{ secrets.AWS_PYTORCH_UPLOADER_ACCESS_KEY_ID }}",
        "aws-pytorch-uploader-secret-access-key": "${{ secrets.AWS_PYTORCH_UPLOADER_SECRET_ACCESS_KEY }}",
        "conda-pytorchbot-token": "${{ secrets.CONDA_PYTORCHBOT_TOKEN }}"
      },
      "uses": "./.github/workflows/_binary-upload.yml"
    },
    "manywheel-py3_11-cuda11_6-build": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "uses": "./.github/workflows/_binary-build-linux.yml",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cu116",
        "GPU_ARCH_VERSION": 11.6,
        "GPU_ARCH_TYPE": "cuda",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cuda11.6",
        "DESIRED_PYTHON": "3.11",
        "build_name": "manywheel-py3_11-cuda11_6",
        "build_environment": "linux-binary-manywheel"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}"
      }
    },
    "manywheel-py3_11-cuda11_6-test": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_11-cuda11_6-build",
      "uses": "./.github/workflows/_binary-test-linux.yml",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cu116",
        "GPU_ARCH_VERSION": 11.6,
        "GPU_ARCH_TYPE": "cuda",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cuda11.6",
        "DESIRED_PYTHON": "3.11",
        "build_name": "manywheel-py3_11-cuda11_6",
        "build_environment": "linux-binary-manywheel",
        "runs_on": "linux.4xlarge.nvidia.gpu"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}"
      }
    },
    "manywheel-py3_11-cuda11_6-upload": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_11-cuda11_6-test",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cu116",
        "GPU_ARCH_VERSION": 11.6,
        "GPU_ARCH_TYPE": "cuda",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cuda11.6",
        "DESIRED_PYTHON": "3.11",
        "build_name": "manywheel-py3_11-cuda11_6"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}",
        "aws-access-key-id": "${{ secrets.AWS_PYTORCH_UPLOADER_ACCESS_KEY_ID }}",
        "aws-pytorch-uploader-secret-access-key": "${{ secrets.AWS_PYTORCH_UPLOADER_SECRET_ACCESS_KEY }}",
        "conda-pytorchbot-token": "${{ secrets.CONDA_PYTORCHBOT_TOKEN }}"
      },
      "uses": "./.github/workflows/_binary-upload.yml"
    },
    "manywheel-py3_11-cuda11_7-with-pypi-cudnn-build": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "uses": "./.github/workflows/_binary-build-linux.yml",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cu117",
        "GPU_ARCH_VERSION": 11.7,
        "GPU_ARCH_TYPE": "cuda",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cuda11.7",
        "DESIRED_PYTHON": "3.11",
        "build_name": "manywheel-py3_11-cuda11_7-with-pypi-cudnn",
        "build_environment": "linux-binary-manywheel",
        "PYTORCH_EXTRA_INSTALL_REQUIREMENTS": "nvidia-cuda-runtime-cu11;nvidia-cudnn-cu11==8.5.0.96;nvidia-cublas-cu11==11.10.3.66"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}"
      }
    },
    "manywheel-py3_11-cuda11_7-with-pypi-cudnn-test": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_11-cuda11_7-with-pypi-cudnn-build",
      "uses": "./.github/workflows/_binary-test-linux.yml",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cu117",
        "GPU_ARCH_VERSION": 11.7,
        "GPU_ARCH_TYPE": "cuda",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cuda11.7",
        "DESIRED_PYTHON": "3.11",
        "build_name": "manywheel-py3_11-cuda11_7-with-pypi-cudnn",
        "build_environment": "linux-binary-manywheel",
        "runs_on": "linux.4xlarge.nvidia.gpu"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}"
      }
    },
    "manywheel-py3_11-cuda11_7-with-pypi-cudnn-upload": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_11-cuda11_7-with-pypi-cudnn-test",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cu117",
        "GPU_ARCH_VERSION": 11.7,
        "GPU_ARCH_TYPE": "cuda",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cuda11.7",
        "DESIRED_PYTHON": "3.11",
        "build_name": "manywheel-py3_11-cuda11_7-with-pypi-cudnn"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}",
        "aws-access-key-id": "${{ secrets.AWS_PYTORCH_UPLOADER_ACCESS_KEY_ID }}",
        "aws-pytorch-uploader-secret-access-key": "${{ secrets.AWS_PYTORCH_UPLOADER_SECRET_ACCESS_KEY }}",
        "conda-pytorchbot-token": "${{ secrets.CONDA_PYTORCHBOT_TOKEN }}"
      },
      "uses": "./.github/workflows/_binary-upload.yml"
    },
    "manywheel-py3_11-cuda11_7-build": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "uses": "./.github/workflows/_binary-build-linux.yml",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cu117",
        "GPU_ARCH_VERSION": 11.7,
        "GPU_ARCH_TYPE": "cuda",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cuda11.7",
        "DESIRED_PYTHON": "3.11",
        "build_name": "manywheel-py3_11-cuda11_7",
        "build_environment": "linux-binary-manywheel"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}"
      }
    },
    "manywheel-py3_11-cuda11_7-test": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_11-cuda11_7-build",
      "uses": "./.github/workflows/_binary-test-linux.yml",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cu117",
        "GPU_ARCH_VERSION": 11.7,
        "GPU_ARCH_TYPE": "cuda",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cuda11.7",
        "DESIRED_PYTHON": "3.11",
        "build_name": "manywheel-py3_11-cuda11_7",
        "build_environment": "linux-binary-manywheel",
        "runs_on": "linux.4xlarge.nvidia.gpu"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}"
      }
    },
    "manywheel-py3_11-cuda11_7-upload": {
      "if": "${{ github.repository_owner == 'pytorch' }}",
      "needs": "manywheel-py3_11-cuda11_7-test",
      "with": {
        "PYTORCH_ROOT": "/pytorch",
        "BUILDER_ROOT": "/builder",
        "PACKAGE_TYPE": "manywheel",
        "DESIRED_CUDA": "cu117",
        "GPU_ARCH_VERSION": 11.7,
        "GPU_ARCH_TYPE": "cuda",
        "DOCKER_IMAGE": "pytorch/manylinux-builder:cuda11.7",
        "DESIRED_PYTHON": "3.11",
        "build_name": "manywheel-py3_11-cuda11_7"
      },
      "secrets": {
        "github-token": "${{ secrets.GITHUB_TOKEN }}",
        "aws-access-key-id": "${{ secrets.AWS_PYTORCH_UPLOADER_ACCESS_KEY_ID }}",
        "aws-pytorch-uploader-secret-access-key": "${{ secrets.AWS_PYTORCH_UPLOADER_SECRET_ACCESS_KEY }}",
        "conda-pytorchbot-token": "${{ secrets.CONDA_PYTORCHBOT_TOKEN }}"
      },
      "uses": "./.github/workflows/_binary-upload.yml"
    }
  }
}